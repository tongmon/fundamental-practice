C++ 빌드를 위한 VS Code 세팅

## VS Code에서 C++ 빌드를 하기 위한 사전 준비

1. Microsoft Store에 들어가서 Windows Terminal을 설치해준다.

2. Windows Terminal에서 PowerShell 탭을 열고 $PSVersionTable 명령어를 수행한 뒤에 출력된 PSVersion이 3 이상인지 확인한다. (3이하라면 PowerShell을 업데이트해준다. PowerShell 업데이트 방법은 알아서 찾아라...)

3. .NET Framework 4.5 버전 이상이 설치되어 있는지 확인한다. (Visual Studio에서 ".NET 테스크톱 개발" 항목을 선택하면 알아서 최신버전의 .NET Framework를 설치해준다.)

4. Windows Terminal을 관리자 모드로 열고 PowerShell 탭을 띄운후에 Get-ExecutionPolicy 명령어를 수행 후에 Restricted인지 확인한다. Restricted이라면 Set-ExecutionPolicy AllSigned 명령어를 추가적으로 수행해준다.

5. Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')) 명령어를 수행해 Chocolatey를 설치해준다.

6. 설치가 끝났으면 Windows Terminal를 관리자 모드로 재시작해주고 PowerShell 탭을 띄우고 choco 명령어를 수행해 Chocolatey가 잘 설치되었는지 확인한다.

7. choco install cmake, choco install graphviz, choco install git, choco install doxygen.install, choco install python, choco install make, choco install llvm 명령어를 순차적으로 실행해서 CMake 활용에 필요한 프로그램들을 깔아준다. (llvm은 clang 컴파일러를 사용하지 않을 것이라면 굳이 안깔아도 된다.) 여기서 중요한 점은 cmake 시스템 환경변수가 올바르게 등록되었는지를 알아야 한다. 

8. CMake를 설치해도 PowerShell 관리자 모드에서 cmake --version 명령어가 제대로 실행되지 않는다면 환경변수가 제대로 설정되지 않은 것이니 시스템 속성 -> 고급 탭 -> 환경 변수 -> 시스템 변수 -> Path 에 cmake.exe가 위치한 폴더 경로를 추가해주자. (보통 "C:\Program Files\CMake\bin" 이거다.)

## 아래는 VS Code에서 C++ 사용시 유용한 플러그인 이름이 나열된다. 설명에 설치 선택이라는 말이 없으면 그냥 깔자. (플러그인 이름 by 작성자)

1. C/C++ by Microsoft
VS Code에서 C++ 사용하고 싶으면 그냥 깔자. Intellisense, debugging 등 필수적인 요소들을 제공한다.

2. Better C++ Syntax by Jeff Hykin
VS Code 에디터에서 C++ 코드를 하이라이팅(에러 표시, 매크로 변수 색 표시 등...)하는 것을 도와준다. (글자 색이 잘 눈에 띄기 위해서 Dark+ 테마에서 잘 작동한다고 되어 있다.)

3. Better Comments by Aaron Bond
주석 표시 색상을 알맞게 바꿔준다. 예를 들어 "// !" 처럼 느낌표가 붙는 주석은 빨간색, "// ?" 는 진한 파란색, "// TODO: " 는 주황색 등... (json 파일로 커스터마이징이 가능하니 더 많은 정보는 플러그인 설명 참조)

4. CMake by twxs
VSCode에서 CMake로 C++을 빌드하고 싶다면 깔자. (물론 컴퓨터에 이미 CMake가 깔려있어야 한다.)
CMake 외에 C++을 VS Code에서 빌드하는 방법은 Makefile 뿐인데... 그냥 CMake가 유일한 선택지라고 생각하자.

5. CodeLLDB by Vadim Chugunov
C++ 디버깅할 때 유용하다.

6. CodeSnap by adpyke
코드 내용을 스크린샷 찍을 때 유용하다. 코드 부분을 마우스로 긁어 원하는 만큼 선택하고 우측클릭하고 CodeSnap을 누르면 된다.

7. Doxygen by Baptist BENOIST
코드 문서 자동화 Doxygen 프로그램의 .dox 파일을 하이라이팅 해준다.

8. Doxygen Documentation Generator by Christoph Schlosser
Doxygen 문서를 만드는 데 필요한 주석 형식을 간단히 만들어 준다. (기본적으로 /** + 엔터를 치면 Doxygen 주석 형식이 갖춰진다.)

9. EditorConfig for VS Code by EditorConfig
.editorconfig 파일에서 프로젝트에 존재하는 파일들을 작성할 때 utf-8로 작성할 것인지, 특정 cpp 파일에서 탭을 공백 몇개로 지정할 것인지 적어서 세팅할 수 있게 해준다. (.editorconfig 파일은 프로젝트 폴더 최상위에 위치해야하며 우측 클릭으로 Generate .editorconfig를 하여 만들 수도 있다.)

10. Error Lens by Alexander
VS Code 코드 에디터에서 코드 에러 띄우는 기능을 개선해준다.

11. Partial Diff by Ryuichi Inagaki
코드 각 부분의 문자열 비교를 할 때 용이하다.

12. Path Intellisense by Christian Kohler
해당 플러그인을 설치하면 코드에서 파일 경로를 치는 경우 자동완성 기능이 제공된다.

13. C++ Helper by amir
함수 선언부에 우클릭을 하면 함수 정의부를 만들 수 있는 옵션이 뜬다. 클릭 몇 번으로 함수 정의부를 만들어 주고 ifndef __HEADER_GUARD__ 와 같은 헤더 가드도 생성해준다.

14. CMake Tools by Microsoft
CMake 관련된 작업을 할 때 유용하다. makefile로 명령어를 묶어 실행해 빌드하는 스타일이라면 꺼놓는 것이 좋다. (설치 선택)

15. Hex Editor by Microsoft
제목 그대로 VS Code에서 16진수 편집이 가능해진다. (설치 선택)

16. C/C++ Include Guard by Akira Miyakoda
헤더 파일을 생성할 때 자동으로 헤더 가드를 붙여준다. (설치 선택)

## C++을 빌드할 수 있는 환경이 다양한 플러그인 설치를 통해 만들어졌다면 이제 실제 코드를 작성하는 경우 생산성을 높여주는 것들에 대해서 알아본다.

1. "VS Code 설정(좌측 하단 톱니바퀴 아이콘) -> 확장 -> C/C++"에 들어가서 Clang_format_fallback Style에 { BasedOnStyle: LLVM, IndentWidth: 4, ColumnLimit: 0 } 이 녀석을 넣어준다. BasedOnStyle의 종류는 다양하니 clang format 종류를 검색해보자. Visual Studio를 많이 써왔다면 Microsoft가 친근할 것이다.

2. Clang_format_style에도 { BasedOnStyle: LLVM, IndentWidth: 4, ColumnLimit: 0 } 이 녀석을 넣어준다.

3. 취향에 따라 Before Else(else를 새 줄에 배치)와 같은 세부 구성을 설정한다. (써보니 설정한 Clang Format이 나한테 정말 잘 맞다 싶으면 굳이 세부 구성 설정까지 안해도 된다.)

4. "VS Code 설정(좌측 하단 톱니바퀴 아이콘) -> 텍스트 편집기 -> 서식"에서 Format On Paste, Format On Save, Format On Save Mode를 모두 켜준다. 세이브를 하거나 세미콜론을 붙이거나(이 경우 해당 줄만) 텍스트를 붙여넣는 경우 지정한 clang format 형식에 맞춰 텍스트를 재조립해준다.

## 코드 작성까지 원활해 졌으니 이제 디버깅을 해야 한다.

1. 보기 -> 명령 팔레트 -> C/C++ 디버그 구성 추가 -> 자신이 사용하는 컴파일러를 선택(예를 들어 gcc를 사용한다면 "C/C++: g++.exe 활성 파일 빌드 및 디버그"를 선택)

2. 1번 작업을 통해 .vscode 폴더 내부에 launch.json과 task.json 파일이 생성되었을 것이다. launch.json 파일의 program 경로를 자신이 디버깅할 실행 파일 경로로 바꿔준다. 예를 들어 프로젝트_폴더/build/Debug/MyExecutable.exe에 있다면 "program": "${workspaceRoot}\\build\\Debug\\MyExecutable.exe" 이렇게 해주면 된다.

3. task.json 파일의 "args" 항목을 보면 "-o" 다음 경로로 지정되어 있는 "${fileDirname}\\${fileBasenameNoExtension}.exe" 이 녀석이 있을텐데 얘도 "${workspaceRoot}\\build\\Debug\\MyExecutable.exe" 경로로 설정해준다.

4. F5를 눌러 디버깅을 하면 된다.

5. 복잡한 코드를 디버깅 하는 경우 "undefined reference to ..." 오류가 날 수 있다. 해당 오류가 발생하면 실행파일을 VS Code가 지워버리는데 이를 해결하려면 task.json을 수정해줘야 한다.
이유를 간단히 살펴보면 예를 들어 main.cpp에서 XmlBuilder 클래스를 사용하고 있는데 이 녀석에 대한 파일을 참조하지 못해서 디버깅 시에 오류가 발생하는 것이다.
해결법은 XmlBuilder 클래스가 정의되어 있는 cpp 파일의 위치를 알려주면된다.
task.json의 "-g" 인자로 경로를 추가해준다. 보통 default 값은 ${file} 이다.
예를 들어 XmlBuilder 클래스가 존재하는 파일의 위치가 "프로젝트_폴더/xml/xmlbuilder.cpp" 라면 "${workspaceRoot}\\xml\\xmlbuilder.cpp" 를 추가한다.
그러면 보통 task.json의 모습은 밑과 비슷할 것이다. 
{
    "tasks": [
        {
            "type": "cppbuild",
            "label": "C/C++: g++.exe 활성 파일 빌드",
            "command": "C:\\msys64\\mingw64\\bin\\g++.exe",
            "args": [
                "-fdiagnostics-color=always",
                "-g",
                //"${file}",
                "${workspaceRoot}\\main.cpp",
                "${workspaceRoot}\\xml\\xmlbuilder.cpp"
                "-o",
                "${workspaceRoot}\\build\\Debug\\StudyProject.exe"
            ],
            "options": {
                "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": "build",
            "detail": "디버거에서 생성된 작업입니다."
        }
    ],
    "version": "2.0.0"
}