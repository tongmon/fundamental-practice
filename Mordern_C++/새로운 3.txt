처리되지 않은 예외 발생(0x7768B502, HDFileManager.exe): Microsoft C++ 예외: char, 메모리 위치 0x005DF0EC.

HU_InitHWPPath


CString strVersion;
	HU_GetFileVersion(CHWPAppInfo::GetHWPExecutablePath(), strVersion.GetBuffer(MAX_PATH));
	strVersion.ReleaseBuffer();

	CStringArray arrVersion;
	HU_SplitStringBySepCharset(strVersion, _T(" ,."), arrVersion);

	switch (atoi(arrVersion.GetAt(0)))
	{
	case 7:
		return HWP_VER_2007;
	case 8:
		return HWP_VER_2010;
	case 9:
		if (atoi(arrVersion.GetAt(1)) >= 6)
			return HWP_VER_NEO;
		else
			return HWP_VER_2014;
	case 10:
		return HWP_VER_2018;
	case 11:
		return HWP_VER_2020;
	default:
		return HWP_VER_NOTSUPPORTED;
	}

	return HWP_VER_NOTSUPPORTED;
	
	
	
	
	
IDC_APPR_METHOD -> 결재방법 콤보, m_sancmethod
관련 함수 -> OnSancMethodSelChange, OnDropdownSancMethod, OnUpdateApprMethod

BASE_GetSancTypeText -> 결재 방법 텍스트 따오는 로직

else if (HS_USER_JUNKYUL == lSignerType &&
			HS_SUBTYPE_INJIDAE == strSignerSubType)
		{
			strMethod.HDLoadString(IDS_APPRMETHOD_INJIDAE, true);
			return strMethod;
		}
		
lSignerType -> 결재 방법
strSignerSubType -> 얘가 인지대 세팅되는 부분 찾아야 함
PutSignerSubType

HS_USER_INJIDAE

SignerTypeToLong -> 결재 방법을 enum으로 바꿈, enum에 인지대 있음

IsReAssignableSigner, ReverseSignList, GetJeonkyulSignerInfo -> 신버전에 없음

MappingDoneSignerToCell -> 로직 많이 다름


ENTRY_USE_INJIDAE_SANCMETHOD -> 인지대 사용하는지 아닌지

m_sancmethod -> 결재선 방법 결정 콤보박스

6.0 결재 방법 내리기 -> OnDropdownSancMethod()

신버전 -> DropDownSancMethodByNormalUser()

6.0 인지대 조건 검사 -> CanBeInjidae

D:\Work\K_HSO\BinDebug\XSAppr.exe 
/WordType:3 /appl gian /AJHOMS201540000093000 /T통합-회신기안-사본배포마크 /UID:001005801 /HOST:123.212.190.178:9332 /K:00wMg1QJ13 /USERAGENT:edge

https://hrdked.kr/web/html/00_main/






CellTitleTypeOfDeptAudit, CellTitleTypeOfUserAudit 이 두개의 구분자는 , 컴마임

DefineAuditDeptPos 지금 얘는 결재선의 직위 직책 텍스트 부분에도 영향을 미치고 있는데 이게 영향을 미치지 않게 해야 하는지?

C:\Work\svn.8.3.trunk\sanc\SaKyul\ButtonDef.h


ViewSummary
EnableViewSummary -> 조건 검사



StampMode.MatchAllBelongDepartment 8.3 직인
OfficialStampMode.MatchAllBelongDepartment 8.2 관인




64 -> 관련문서
139 -> 관련문서 열람



C:\Work\svn.10.2.trunk\BinDebug\XSAppr.exe 
/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy0\21044_~2.TMP


[한글] 발송처리 시, 관인관련 개선

한글 클라이언트 결재에서
1. 발송처리 시, 관인이 발송처리자 부서를 기준으로 표시되고 있습니다.
해당 문서의 결재선에 따라 관인이 표시되어야 하는데 (결재권자 부서의 부서장인, 기관의 관인 등) 무조건 발송처리자 기준으로 표시가 됩니다.
타부서에서 발송의뢰를 한 경우에 문제가 됩니다.


HSO-9371


C:\Work\svn.10.2.trunk\BinDebug\XSAppr.exe 
/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy0\180_PF~1.TMP


C:\Work\svn.10.2.trunk\sactrl32\SaBase32\SignInfo\SIGNINFO.cpp





D:\Work\svn.8.3.tag\V8312_23_PatchRelease\sanc\sacomm32\SancLineCheckOK.cpp


COMM_PrintSetup
COMM_PrintDocumentNoSetup
COMM_PrintDoc


PrintDocument
PrintAttachments

bool CObjectInfo::Print(LPHCC lpHCC) -> 쉘로 인쇄함



GetDefaultPrinter -> 기본 프린터 이름 검색


PDF 연결프로그램이 브라우저인 경우 

COMM_PrintAttachHWN

COMM_PrintDoc

이미 결재 프로그램이 실행중 입니다.



CClientTypeKey -> 뮤텍스


GetSanctionBody -> 여기서 하는 듯

C:\Work\svn.10.2.trunk\BinDebug\XSAppr.exe 
/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy0\27596_~2.TMP


SetClientTypeName


GIAN_SetClientTypeName


CMWFElement* pMWFElement = GetMWFElement(lpHCC->szMWFIniFilePath);
위가 안되면 밑 cmd 파라미터 읽어서 차선책으로 수행
::GetPrivateProfileString()


C:\Work\svn.10.2.trunk\BinDebug\XSAppr.exe 
/WordType:3 /appl gian 1 /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy0\8028_P~1.TMP


ENTRY_MSGID -> 옵션 이름

C:\Users\DP91-HSK\AppData\Local\Temp\handy0\8028_P~1.TMP




TCHAR strApprID[MAX_PATH];
::GetPrivateProfileString(strSection, ENTRY_MSGID, _T(""), strApprID, sizeof(strApprID), lpListFilePath);



C:\Work\svn.10.2.trunk\BinDebug\XSAppr.exe 
/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy0\33760_~2.TMP

IDC_PERM

D:\Work\svn.8.3.tag\V8314_21_hotfix\BinDebug\XSAppr.exe 
/WordType:3 /appl gian /AJHOMS193430028761000 /T수자원유통서식 /UID:004133000 /HOST:123.212.190.148:8382 /K:00SI1zQn3 /INTRA:1 /USERAGENT:edge







여기서 T sum_all(T k) 함수가 없으면 sum_all의 마무리를 지을 수가 없기에 에러가 난다.

위 함수를 더 효과적으로 적을 수 있는데 C++17에서는 fold 기법을 제공한다.
위의 sum_all 함수는 밑과 같이 적을 수가 있다.
template <typename... Ints>
int sum_all(Ints... nums) {
  return (... + nums);
}

재귀적 호출이라 두 개로 쪼개져 있던 sum_all 함수를 fold 기법을 사용하면 하나로 나타낼 수 있다.
fold 기법을 사용하려면 







https://github.com/webview/webview
위 녀석 사용하고 배포하는 방법
C++20 기준
프로젝트 속성에서 /await /Zc:twoPhase- 추가해야댐, 그래야 coroutine 오류 안남
nuget에서 webview2에 대한 패키지 설정해야 댐
프로젝트 dll에 WebView2Loader.dll, webview.dll 이 두 녀석 추가해야댐
배포시에는 저 두 dll만 있으면 됨 다른거 필요없음

void CEdgeBrowserAppDlg::SendMessageClicked()
{  
  m_webView->ExecuteScript(L"document.documentElement.outerHTML", 
  Callback<ICoreWebView2ExecuteScriptCompletedHandler>
  (this, &CEdgeBrowserAppDlg::ExecuteScriptResponse).Get());
} 
--> 아마 이게 html 코드 전체 긁어오는듯?


Callback<ICoreWebView2ExecuteScriptCompletedHandler>([](HRESULT error, PCWSTR result) -> HRESULT {}).Get()

https://smok95.tistory.com/289


D:\Work\svn.8.3.tag\V833_15_PatchRelease\BinDebug\XSAppr.exe 
/WordType:3 /appl gian /AJHOMS193430028761000 /T수자원유통서식 /UID:004133000 /HOST:123.212.190.148:8383 /K:00Op5m7S1 /INTRA:1



C:\Users\DP91-HSK\source\repos\MFC_CEF\MFC_CEF\libcef.lib

C:\Users\DP91-HSK\source\repos\MFC_CEF\MFC_CEF\libcef_dll_wrapper.lib

cmake -G "Visual Studio 17"




https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=beodeulpiri&logNo=221497743002 -> CEF 팁




http://123.212.190.148:8300/bms/com/hs/gwweb/appr/hstCmdEx.act?APPRIDLIST=JHOMS220050036335000&APPLID=8010&USERID=004133000&K=00ZDA3SIV&WORDTYPE=%WORDTYPE%&CLTAPP=1

http://123.212.190.148:8300/bms/com/hs/gwweb/appr/hstCmdEx.act?APPRIDLIST=%APPRID%&APPLID=%APPLID%&USERID=004133000&K=00ZDA3SIV&WORDTYPE=%WORDTYPE%&CLTAPP=1







(완료)(D-GW-27939)(8.3.3.15(h01)) CLONE - [대구은행] GW-27741 - 클라이언트 첨부 폴더명이 길 경우..에 대한모듈적용이후.

1. 요구/변경/처리사항

가. 환경
붙임문서 리스트에 추가된 첨부파일을 우측클릭하여 저장하는 경우 저장이 안되는 현상이 있었는데 이를 해결하였습니다.

나. 구현내용
붙임문서 로직에 HU_UnicodeToMultibyte() 함수를 추가하고 DragQueryFileA -> DragQueryFileW로 수정하였습니다.

2. 관련모듈
HsAttach.dll

3. 영향도 분석

4. 관련 옵션내용

5. 미구현 및known bug

6. 개발자 TEST 항목
해당 버전으로 기안하고 붙임문서에 파일 추가하고 해당 문서 항목을 우클릭하여 저장하는 과정이 정상적으로 처리되는지 확인하였습니다.



GW-12032 -> 관련문서 티켓 8.3 trunk



CLONE - [대구은행] GW-27741 - 클라이언트 첨부 폴더명이 길 경우..에 대한모듈적용이후. 
8.3.3.15(h01)
GW-27939

CLONE - [HSO10.2.1] 문서본문내 하이퍼링크 클릭시 파라미터 붙는 현상
10.2.1.0
HSO-11888


- [대구은행] (완료) (D-HSO-11888) (10.2.1.0) CLONE - [HSO10.2.1] 문서본문내 하이퍼링크 클릭시 파라미터 붙는 현상


201903046P진행

- [한국수자원공사] (진행) (D-HSO-8426) (10.2.1.0) CLONE - [한국수자원공사] 종알림이에서 내용보기 클릭시 IE브라우저로 뜨는 현상
- CEF 분석



-DCEF_RUNTIME_LIBRARY_FLAG=/MD -DUSE_SANDBOX=Off


cmake -DCEF_RUNTIME_LIBRARY_FLAG=/MD -DUSE_SANDBOX=Off -G "Visual Studio 17" -A Win32 ..





%(PreprocessorDefinitions)
_SILENCE_ALL_CXX17_DEPRECATION_WARNINGS
WIN32
_WINDOWS
_DEBUG
__STDC_CONSTANT_MACROS
__STDC_FORMAT_MACROS
_WIN32
WINVER=0x0601
_WIN32_WINNT=0x601
NOMINMAX
WIN32_LEAN_AND_MEAN
_HAS_EXCEPTIONS=0
CEF_USE_ATL


_SILENCE_ALL_CXX17_DEPRECATION_WARNINGS
WIN32
_WINDOWS
_DEBUG



C:\Users\DP91-HSK\source\repos\CEF_multiprocess\CEF_EXE\cefsimple.exe




201903046P진행
- [한국수자원공사] (진행) (D-HSO-8426) (10.2.1.0) CLONE - [한국수자원공사] 종알림이에서 내용보기 클릭시 IE브라우저로 뜨는 현상
- CEF 분석



if (CreateProcessW(ApplicationName, CommandLine, 0, 0, 0, 0, 0, 0, &si, &pi))
    {
        CloseHandle(pi.hThread);

        MSG msg;

        for (;;)
        {
            switch (MsgWaitForMultipleObjectsEx(1, &pi.hProcess, INFINITE, QS_ALLINPUT, 0))
            {
            case WAIT_OBJECT_0:
                CloseHandle(pi.hProcess);
                return TRUE;
            case WAIT_OBJECT_0 + 1:
                while (PeekMessage(&msg, 0, 0, 0, PM_REMOVE))
                {
                    TranslateMessage(&msg);
                    DispatchMessage(&msg);
                }
                continue;
            default: __debugbreak();
            }
        }
    }
	
	
	PAINT 15, WM_IME_KEYUP 657,






if (HA_SaveDocument(lpHCC, szTempPath, FILEFORMAT_HWP))
			{
				// 5. 저장한 문서 오픈
				if (BASE_DrmProcessBeforeDocOpen(lpHCC, szTempPath) &&
					HA_OpenDocument(LPDUMMYHCC, szTempPath, NULL, "clientedit", 0, FALSE, FILEFORMAT_HWP))
				{
#ifndef _DEBUG
					HICON hIcon = AfxGetApp()->LoadIcon(IDI_SAVE);
					CHDMsg docMsg(hIcon, IDS_SAVE_DOCUMENT);
#endif
					// 6. 사인셀 지우기
					if (bClearSign)
						COMM_ClearSignCell(LPDUMMYHCC);

					// 7. 저장하기
					LOG4CPLUS_TRACE(logger, "COMM_SaveDocumentEx, HA_SaveDocument LPDUMMYHCC");
					bResult = HA_SaveDocument(LPDUMMYHCC, lpSavePath, wSaveFormat);

					if (bSaveToImage && pArrBodyImgFiles)
						HA_PrintToImage(LPDUMMYHCC, HU_ReplaceExtension(lpSavePath, _T("png")), pArrBodyImgFiles);					
				}
			}
			
			
			






감사부서 -> 요약전 버튼 이름을 일상감사로 바꿈
의견서 UI -> 요약전 말고 일상감사






IDS_SAGIAN_MSG_000028   "요약전이 변경되었습니다. 요약전을 저장하시겠습니까?"

IDS_SAGIAN_MSG_000029   "요약전을 저장하시겠습니까?"	

IDS_SAGIAN_MSG_000033   "요약전 작성"

IDS_SACOMM32_MSG_000294 "요약전 편집"

IDS_SACOMM32_MSG_000047 "요약전 보기"



ini 옵션과 부서가 감사부서인지 검사를 해서 툴바 ini에 set 조정, 감사부서 접수기, 감사부서 결재기

16 - 요약전

/WordType:3 /appl gian 1 /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\2252_P~1.TMP







IDC_EDIT_RECV_DISPLAYSTRING -> 수신자 표기
IDC_HDUAGENT_ADD -> 추가
IDC_HDUAGENT_REMOVE -> 삭제

AddRecipientToList -> 얘가 조정하는 듯 -> AddRecItem

UpdateAddableState -> 추가 가능 상태를 정하는듯

OnOwnSelChange -> 얘도 항상 지나침 SetItemState -> (BOOL) ::SendMessage(m_hWnd, LVM_SETITEMSTATE, nItem, (LPARAM)&lvi); 여기서 트리거 함




/WordType:3 /appl ma

na /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\14060_~2.TMP


SendOrgName.Type.발송종류
ExternalSenderName.DefaultType

현재 - 기안자의 소속부서 관인

m_hsDraftRepDeptID -> 기안 부서의 기관 ID

DUA_GetRepDeptName(&hsBaseDeptID, &hsRepDeptID, strRepDeptName.GetBuffer(MAX_PATH)); -> 기관 구하는 함수


/WordType:3 /appl gian /AJHOMS193430028761000 /T수자원유통서식 /UID:004133000 /HOST:123.212.190.148:8383 /K:00ZCO24wu3 /INTRA:1 /USERAGENT:edge



핸디소프트(기관)(500000468) -> 연구개발본부(기관)(000024100) -> SW개발연구소(000011303) -> 다큐플로팀(000022725)

경영지원팀(500609344)



발신기관명 -> SendOrgName.Type.External
발신명의 -> ExternalSenderName.DefaultType
internalSenderName.DefaultType

SEND_ORGNAME -> 발신기관명
SENDER_NAME -> 발신명의




- [제주특별자치도개발공사] (답변완료) (C-GW-27997) (8.3.12.23(h01)) [제주특별자치도개발공사] GW-27842 티켓에 대한 추가자료 202103015M
- [HSK] (완료) (D-GW-27987) (8.3.20.0) [한글] 기 발송완료된 문서를 재발송시 수신자지정 UI창 문제 마보현
- [한국교육학술정보원] (완료) (D-GW-23548) (8.3.20.0) CLONE - 수신자표기명 기능개선 요청  201808072P진행
- (완료) (I-HSO-11966) (10.0.0.14) 수신자표기명 기능개선 요청
- (완료) (I-HSO-11965) (10.2.1.0) 수신자표기명 기능개선 요청

[한글] 비공개 5호 의사결정 또는 내부검토 default 90일 설정 안되어 있음 GW-28002 8.3.20.0






CLONE - [제주특별자치도개발공사] GW-27842 티켓에 대한 추가자료  8.3.12.23(h04)
GW-28015



D:\Work\svn.8.3.tag\V8315_09_hotfix\BinDebug\XSAppr.exe 
/WordType:3 /appl gian  GIAN_REJECT /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\15932_~2.TMP


bSkipSigner -> 기결재자 통과 플래그
SANCLINE_SKIP -> 기결재자 통과 매크로
COMM_SetModifiedDataToForm -> 재기안시 기결재자의 sign을 지우냐의 여부를 결정
COMM_IsKyuljaeDone -> 기결재자인가?
IDS_SKIP_DONESIGNER     "기결재자를 통과하시겠습니까?"
GetMapping_NormalSignCell
DeleteSignImage() -> 기결재자 통과 여부에 따른 서명 삭제


부재사유가 있음 + 결재 유형이 NoApproval이 아님 + 대리 결재자 alterID가 없음 -> 회송으로 도착한 것을 본인이 직접 결재하는 경우




/WordType:3 /appl gian /AJHOMS193430028761000 /T수자원유통서식 /UID:004133000 /HOST:123.212.190.148:8383 /K:00eJ737Ld2 /INTRA:1 /USERAGENT:edge


CLastError::SetGeneralLastError(GWConstants::Client::SACOMM_DRM_FAIL)







(완료)(D-GW-28015)(8.3.12.23(h04)) CLONE - [제주특별자치도개발공사] GW-27842 티켓에 대한 추가자료

1. 요구/변경/처리사항

가. 환경
잘못 커밋된 내용 수정

나. 구현내용
잘못 커밋된 내용 수정

2. 관련모듈
SaBase32.dll

3. 영향도 분석

4. 관련 옵션내용

5. 미구현 및 known bug

6. 개발자 TEST 항목
내용 수정하고 빌드하여 정상적으로 되나 확인하였습니다.







HC_AFTERCREATE
hsGetServerProfileBool(SERVER_INI_APP, SERVER_INI_KEY_WRAPSODY_UNWRAPPING, FALSE)



(완료)(D-GW-28028)(8.3.20.0) CLONE - [제주특별자치도개발공사] GW-27842 티켓에 대한 추가자료

1. 요구/변경/처리사항

가. 환경
랩소디 모듈에 유니코드 인코딩 처리를 하였습니다.

나. 구현내용
랩소디 모듈에 유니코드 인코딩 처리를 하였습니다.

2. 관련모듈
SaBase32.dll

3. 영향도 분석

4. 관련 옵션내용

5. 미구현 및 known bug

6. 개발자 TEST 항목
코드 빌드가 정상적으로 수행되는지 확인하였습니다.


- 헤더 변경하셈

BOOL IsWrapSodyUnwrapAvailable()
{
	/*
	WrapDocInfo oWrapDoc;

	DWORD_PTR pfnProcedure = DWORD_PTR();
	pfnProcedure = oWrapDoc.GetProcedure(oWrapDoc.DOCINFOAPI_INITMANAGE);

	return (pfnProcedure ? TRUE : FALSE);
	*/
	return FALSE;
}



sabase32
apprres
sagian
sakyul


ChangeSancLine
COMM_SaveDocTemporarily
COMM_SaveTempDocToServer
COMM_RegisterRejectDoc
COMM_NotApplicable
COMM_SaveToSancbox
COMM_RegisterApprovalDoc
ProcessSanction
Process
COMM_AcceptResend







/WordType:3 /appl gian  GIAN_REJECT /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\520_PF~1.TMP
-> 회송 테스트


/WordType:3 /appl gian /AJHOMS193430028761000 /T수자원유통서식 /UID:004133000 /HOST:123.212.190.148:8382 /K:00tiksuQ1 /INTRA:1 /USERAGENT:edge


후열 앞에 전후열 || 대결 올 수 있음



BOOL CSancLineDlg::CheckJeonHooBeforeDeakyul(CSIGNINFOs& rSignInfos)
{
	CSIGNINFO* pSI = NULL;
	int Size = rSignInfos.GetSize();
	for (int i = 0; i < Size; i++)
	{
		pSI = rSignInfos.GetAt(i);
		if (pSI->IsTypeJunkyulHooyul()) {
			if (i + 1 >= Size || (i + 1 < Size && !rSignInfos.GetAt(i + 1)->IsTypeDaekyul())) {
				HandyMessage(IDS_CHECKJEONHOOWARNING);
				return FALSE;
			}
		}
	}
	return TRUE;
}

IDS_CHECKHOOYULBEFORELINEWARNING
후열 바로 전 결재자의 결재유형은 전결 혹은 대결이여야 합니다!\n결재선을 다시 확인해주세요!

inspection 밑 3개 수정하기
sanclinecheckok.cpp
sline.h
stringtable








(완료)(D-GW-27509)(8.3.15.09(h03)) 결재방문서 등록시 결재방 플래그와 목록공개 플래그 오류

1. 요구/변경/처리사항

가. 환경
잘못 커밋된 내용 수정

나. 구현내용
잘못 커밋된 내용 수정

2. 관련모듈
sacomm32.dll

3. 영향도 분석

4. 관련 옵션내용

5. 미구현 및 known bug

6. 개발자 TEST 항목
잘못 커밋된 내용 수정



IDS_IS_RETURN_DOC       "%s님에게 문서를 $회송$하시겠습니까?"
IDS_SUCCESS_RETURN      "결재문서가 %s님에게 $회송$되었습니다!"
	
KYUL_ReturnToOrgSigner -> hsReturnToOrgSigner


/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\26220_~2.TMP

홍대리로 회송 버튼을 누르는 시점에서의 현 결재자는 홍대리인데 대리결재자도 홍대리임
원결재자 -> "004113600" 배소미
대리결재자 -> "004128301" 홍대리



/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\25372_~2.TMP

/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\22732_~2.TMP

/WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\27384_~2.TMP


C:\Work\svn.8.3.trunk\BinDebug\XSAppr.exe /WordType:3 /appl kyul /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\25688_~2.TMP


GW-28000 해당 티켓 밑 3개 파일 수정
signinfo.h
signinfo.cpp
signtext.cpp





CLONE - [서울시교통방송(TBS)] 문서회송, 기결재자통과시 서명이 변경되는 현상(재등록)  
8.3.15.09(h03) GW-28050
8.3.20.0 GW-28051
10.2.1.0 HSO-12029


8.3.15.09(h03) C-GW-28000


후열 전에 올 수 있는 결재 유형이 이상한 경우 보완
10.2.1.0 I-HSO-12012

CLONE - [한국조폐공사] Template.0.DefaultViewRestriction 옵션 결함
8.3.15.09(h03) D-GW-28048



AttachPublicSeal



DailyMeetingTextMaker

HSO-12012
후열 전에 올 수 있는 결재 유형이 이상한 경우 보완



Unspecified error
Sagian에서 MB_ICONEXCLAMATION 옵션이 끼여있는 (즉 MSG_QUERY_SAVE, MSG_NOTIFY, MSG_INFORM) 녀석들에서 "지정되지 않은 오류입니다."
근데 결재정보창에서만 뜸

202111009M진행
- [한국자산관리공사] (진행) (C-GW-27998) (8.3.12.23(h04)) [한국자산관리공사] 첨부날인 시 관인이 뒤로 밀려서 찍히는 현상 문의

/WordType:3 /appl gian /AJHOMS201540000093000 /T통합-회신기안 /UID:001005801 /HOST:123.212.190.177:9319 /K:000cH10H42 /USERAGENT:edge




/WordType:3 /appl mana /LFC:\Users\DP91-HSK\AppData\Local\Temp\handy8\33440_~2.TMP




수신 : 김형규

참조 : 김용세, 임권기, 정회신, 이경해



아래 리포팅한 형식 참고해서 메일 보낼것.


GW-27998

-----원본 메시지-----
송신: 정회신
날짜: 2020-11-10 12:09
수신: 김형규
참조: 김용세;박상철;이경해;김석연
제목: [한컴에 리포팅해주세요] GW-25598 [서울교통공사] 대외도착문서 접수기 실행 시 오류 발생






안녕하세요



아래 내용을 한컴에 리포팅 부탁드립니다.



관련티켓 : GW-25598 [서울교통공사] 대외도착문서 접수기 실행 시 오류 발생



=============================================================================



안녕하세요



서울교통공사 고객사에서 대외 문서 접수시 오류가 발생한다는 리포팅이 와서, 

본사에서 디버깅을 해본 결과, 아래와 같은 결과가 나와서 리포팅을 해드립니다.



서울교통공사에서 리포팅된 환경은 한글2010인데,

핸디소프트 본사의 한글2018 환경에서도 동일하게 재연이 됩니다.



외부에서 작성된 유통문서XML을 핸디 그룹웨어에서 접수시 오류가 발생합니다.



정확한 오류 발생 시점은



유통문서 body xml을 임시윈도우로 열고, 접수문서 서식의 본문영역에 Insert후, 

임시윈도우를 닫는 과정에서 오류가 발생해서 접수기 어플리케이션(XSAppr.exe)에서 Crash가 발생합니다.

보통의 유통 body xml은 이상이 없고, 해당 xml 파일을 처리할때만 Crash가 발생합니다.



첨부파일에 대해 설명드리겠습니다.


첨부1_DebugScreen.PNG : 디버거에서 마지막으로 Exception이 발생한 화면입니다. (발생위치 : MsDocGroup.DFT)

첨부2_Dump.zip : 위와 같이 Crash가 발생했을때, %localappdata%\CrashDumps 에 남은 덤프파일입니다.

첨부3_DocFilters.zip : 한글2018 환경안에 포함되어있는 유통필터 파일들입니다. (MsDocGroup.DFT 포함)

첨부4_유통body.xml : 유통문서 body XML 파일입니다.



본사에서 사용된 한글2018 버전은 10.0.0.9139 입니다.



확인 부탁드립니다.



감사합니다.




---------------------------------------------'

안녕하세요. CT 개발팀 이경준입니다.

아래 내용을 한컴에 리포팅 부탁드립니다.

관련티켓 : GW-27998 [한국자산관리공사] 첨부날인 시 관인이 뒤로 밀려서 찍히는 현상 문의
=============================================================================

첨부된 22_02_03_REPORT.hwp 문서를 보시면 1페이지에는 '핸디소프트 대표이사'라는 이미지가 도장을 찍은 것 처럼 처리되어 있는 것을 볼 수 있습니다.
2페이지를 보시면 도장 이미지가 잘려 보이는 것을 알 수 있습니다.
현재 저희 그룹웨어 프로그램에서는 사용자가 클릭한 위치에 도장 이미지를 문서에 박아 넣는 기능이 있습니다.
해당 기능은 도장 이미지를 테이블 셀에 삽입하고 해당 테이블 셀의 크기를 조정한 뒤에 사용자가 클릭한 마우스 위치로 이동시키는 방식으로 작동합니다.
1페이지와 2페이지의 존재하는 개체들의 속성은 모두 동일한데 2페이지의 도장 이미지만 잘려보이는 것은 한글 측 오류로 판단됩니다.
테스트에 사용된 한글 버전은 한글2020 / 11.0.0.5178 입니다.
확인부탁드립니다.

=============================================================================
감사합니다.







안녕하세요. CT 개발팀 이경준입니다.

관인 처리와 관련된 주요 코드 로직은 다음과 같습니다.
-------------------------------------------------------------------------------------------------
// _MoveToField 함수는 lpSealCellName에 지정된 셀 이름에 해당하는 필드로 이동합니다.
// 필드 이동이 성공하면 true를 반환합니다.
if (_MoveToField(lpHCC, lpSealCellName, NULL_STR, NULL_STR, NULL_STR, FALSE))
{
	// SetObjectInfo는 현재 커서가 존재하는 테이블의 속성, 위치를 설정합니다.
	// 주어진 특정 enum 값은 다음과 같습니다.
	// TEXTWRAP_BEHINDTEXT -> 글 뒤로 설정 (실제 값 2)
	// RELTO_PAPER -> 위치 기준은 종이 (실제 값 0)
	// ALIGN_LEFT -> 배열 방식은 왼쪽 (실제 값 0)
	// ALIGN_TOP -> 배열 방식은 위쪽 (실제 값 0)
	SetObjectInfo(lpHCC, TEXTWRAP_BEHINDTEXT, RELTO_PAPER, RELTO_PAPER, ALIGN_LEFT, ALIGN_TOP, iSealXPos, iSealYPos, -1, -1, nPageNumber);
}
-------------------------------------------------------------------------------------------------

SetObjectInfo() 함수 인자에 들어간 여러 변수들은 SHAPEOBJECT라는 구조체의 값으로 설정이 됩니다.
SHAPEOBJECT 구조체는 다음과 같습니다.
-------------------------------------------------------------------------------------------------
typedef struct {
	int		type;			// 객체 유형(NumberingType)
	int		pageNo;			// 페이지 번호
	LONG	offsetX;		// x 위치(HorzOffset)
	LONG	offsetY;		// y 위치(VertOffset)
	LONG	width;			// 폭
	LONG	height;			// 높이
	BOOL	treatAsChar;	// 글자처럼
	int		relToX;			// 가로 위치의 기준(HorzRelTo)
	int		relToY;			// 세로 위치의 기준(VertRelTo)
	int		alignX;			// 가로 배열 방식(HorzAlign)
	int		alignY;			// 세로 배열 방식(VertAlign)
	int		textWrap;		// 본문 배치
	BOOL	lock;			// 선택가능 여부
	BOOL	protectSize;	// 크기 보호(크기 변경 불가)
	int		flowWithText;	// 그리기 개체의 세로 위치를 쪽 영역 안쪽으로 제한할지 여부 on / off
	int		allowOverlap;
} SHAPEOBJECT, *LPSHAPEOBJECT;
-------------------------------------------------------------------------------------------------

아래는 SetObjectInfo() 함수에 대한 코드입니다.
-------------------------------------------------------------------------------------------------
// 현재 커서가 존재하는 테이블 속성(위치 등) 설정
// int nTextWrap - 테이블 주위의 글자 배치(본문과의 배치) 옵션. 어울림, 자리차지, 글 앞으로, 글 뒤로
// int nXRelTo - 가로 위치 기준. 글자붙임, 문단붙임, 쪽붙임 여부(HorzRelTo)
// int nYRelTo - 세로 위치 기준. 글자붙임, 문단붙임, 쪽붙임 여부(VertRelTo)
// int nXAlign - 테이블 가로 위치의 상대적 배열 방식. 왼쪽, 가운데, 오른쪽(HorzAlign)
// int nYAlign - 테이블 세로 위치의 상대적 배열 방식. 위쪽, 가운데, 아래쪽(VertAlign)
// int nXOffset - 테이블 상대적 가로 위치 배열 방식(nXAlign)에 대한 상대적 위치(HorzOffset)
// int nYOffset - 테이블 상대적 가로 위치 배열 방식(nYAlign)에 대한 상대적 위치(VertOffset)
BOOL SetObjectInfo(LPHCC lpHCC, int nTextWrap, 
	int nXRelTo, int nYRelTo, int nXAlign, int nYAlign, int nXOffset, int nYOffset, int nFlowWithText, int nAllowOverlap, int nPageNo)
{
	SHAPEOBJECT so;
	ZeroMemory(&so, sizeof(SHAPEOBJECT));

	so.offsetX = nXOffset;
	so.offsetY = nYOffset;
	so.treatAsChar = (nXRelTo < 0 || nYRelTo < 0);
	so.relToX = nXRelTo;
	so.relToY = nYRelTo;
	so.alignX = nXAlign;
	so.alignY = nYAlign;
	so.textWrap = nTextWrap;
	so.flowWithText = nFlowWithText;
	so.allowOverlap = nAllowOverlap;
	so.pageNo = nPageNo;
	
	return SetObjectInfo(lpHCC, &so);
}

// 현재 커서가 존재하는 테이블 등의 객체의 속성(위치 등) 설정
// 현재는 테이블에 대해서만 동작
BOOL SetObjectInfo(LPHCC lpHCC, const SHAPEOBJECT* lpSO)
{
	if (!lpSO)
		return FALSE;

	CHwpPtr pHwpCtrl = _Local_GetHwpCtrl(lpHCC);
	if (pHwpCtrl == NULL)
		return FALSE;

	// 현재 캐럿이 위치한 부모 컨트롤이 표가 맞는지 확인
	CComPtr<IDispatch> pctrl, pSet;
	pctrl = pHwpCtrl->GetParentCtrl();
	if (pctrl == NULL)
		return FALSE;

	DHwpCtrlCode dctrlcode;
	dctrlcode.AttachDispatch(pctrl);
	if (dctrlcode.GetCtrlid().Compare(_T("tbl")))
		return FALSE;


	// 현재 테이블의 속성을 가져온다
	// TODO: object에 따라 다르게 처리
	CComPtr<IDispatch> pIDisAction = pHwpCtrl->CreateAction(_T("TablePropertyDialog"));
	
	DHwpAction			HwpAction;
	HwpAction.AttachDispatch(pIDisAction);
	DHwpParameterSet Set = HwpAction.CreateSet();
	HwpAction.GetDefault(Set);


	//--------------------------------------------------------------------------
	// Object의 각 속성
	//--------------------------------------------------------------------------
	VARIANT vaVal;

	// 상대적 위치
	vaVal.vt = VT_I4;
	vaVal.lVal = lpSO->offsetX;
	Set.SetItem(HWPID_HorzOffset, vaVal);

	vaVal.lVal = lpSO->offsetY;
	Set.SetItem(HWPID_VertOffset, vaVal);

	// 크기
	vaVal.vt = VT_I4;
	if (lpSO->width > 0)
	{
		vaVal.lVal = lpSO->width;
		Set.SetItem(HWPID_Width, vaVal);
	}
	
	if (lpSO->height > 0)
	{
		vaVal.lVal = lpSO->height;
		Set.SetItem(HWPID_Height, vaVal);
	}

	// 글자처럼 처리
	vaVal.vt = VT_UI1;
	vaVal.bVal = lpSO->treatAsChar;
	Set.SetItem(HWPID_TreatAsChar, vaVal);

	// 위치의 기준
	vaVal.vt = VT_UI1;
	vaVal.bVal = lpSO->relToX;
	Set.SetItem(HWPID_HorzRelTo, vaVal);

	vaVal.bVal = lpSO->relToY;
	Set.SetItem(HWPID_VertRelTo, vaVal); 

	// 배열 방식
	vaVal.vt = VT_UI1;
	vaVal.bVal = lpSO->alignX;
	Set.SetItem(HWPID_HorzAlign, vaVal);

	vaVal.bVal = lpSO->alignY;
	Set.SetItem(HWPID_VertAlign, vaVal);

	// 본문과의 배치
	vaVal.vt = VT_UI1;
	vaVal.bVal = lpSO->textWrap;
	Set.SetItem(HWPID_TextWrap, vaVal);

	//그리기 개체의 세로 위치를 쪽 영역 안쪽으로 제한할지 여부 on / off
	if (lpSO->flowWithText >= 0)
	{
		vaVal.vt = VT_UI1;
		vaVal.bVal = lpSO->flowWithText;
		Set.SetItem(HWPID_FlowWithText, vaVal);
	}

	if (lpSO->allowOverlap >= 0)
	{
		vaVal.vt = VT_UI1;
		vaVal.bVal = lpSO->allowOverlap;
		Set.SetItem(HWPID_AllowOverlap, vaVal);
	}

	if (lpSO->pageNo >= 0)
	{
		vaVal.vt = VT_UI1;
		vaVal.bVal = lpSO->pageNo;
		Set.SetItem(HWPID_PageNumber, vaVal);
	}

	// 선택 가능 여부
	vaVal.vt = VT_UI1;
	vaVal.bVal = lpSO->lock;
	Set.SetItem(HWPID_Lock, vaVal);

	// 크기 보호
	vaVal.vt = VT_UI1;
	vaVal.bVal = lpSO->protectSize;
	Set.SetItem(HWPID_ProtectSize, vaVal);

	// 바깥 여백
	vaVal.vt = VT_I4;
	vaVal.lVal = 0;
	Set.SetItem(HWPID_OutsideMarginLeft, vaVal);
	Set.SetItem(HWPID_OutsideMarginRight, vaVal);
	Set.SetItem(HWPID_OutsideMarginTop, vaVal);
	Set.SetItem(HWPID_OutsideMarginBottom, vaVal);


#ifdef _DEBUG
	BOOL bSetRel = TRUE;
	if (bSetRel == 0)
		HwpAction.PopupDialog(Set);		// test용 개체속성 Dlg
#endif

	int nResult = HwpAction.Execute(Set);

	return TRUE;
}
-------------------------------------------------------------------------------------------------








(완료)(D-GW-27995)(8.3.17.15(h03)) CLONE - GW-25046 MS IE 종료에 따른 "IE 사용안함"일 경우 대응 마련 필요 건 요청

1. 요구/변경/처리사항

가. 환경
이제 결재문서 게시하기, 메일쓰기, 관련문서보기 시에 접속한 브라우저로 실행됩니다.

나. 구현내용
Browser관련 함수들의 로직을 수정하였습니다.

2. 관련모듈
HDUI.dll
HsUtil.dll
HSHttpAPI.dll
Hduagent.dll
SaBase32.dll
sacomm32.dll
SaGian.dll
XSAppr.dll

3. 영향도 분석

4. 관련 옵션내용

5. 미구현 및 known bug

6. 개발자 TEST 항목
문서를 열람하여 메일쓰기, 게시하기, 관련문서보기를 수행하여 로그인한 브라우저로 실행되는지 확인하였습니다.